#var int side=0
#var float angle=90deg
#var float distance=400mm
#var vec2 start_point=(100mm,100mm)
var vec3 start_pose=(0mm,0mm,00deg)
#var vec2 point3=(100mm,200mm)

var float test_distance=400mm
var float test_angle=90deg
var vec3 test_translation_speeds=(500mm,500mm,500mm)
var vec3 test_yaw_speeds=(180deg,180deg,180deg)
var float r_speed=200mm
var float r_accel=1

var vec3 test_goldo_speeds=(500mm,500mm,500mm)
var vec3 test_approche_speeds=(200mm,200mm,200mm)
var vec3 approche_speeds=(200mm,400mm,200mm)

begin sequence prematch_yellow
call slider_range_gauche
call prematch_common
propulsion.set_pose start_pose_yellow
call griffes_range
end sequence

begin sequence prematch_purple
call slider_range_droite
call prematch_common
propulsion.set_pose start_pose_purple
call griffes_range
end sequence

#Sequence de match
begin sequence match_yellow
propulsion.set_pose start_pose_yellow
#prise palet devant rouge
call preprise_sol
propulsion.move_to palet_zone_rouge_yellow,test_goldo_speeds
wait_movement_finished palet_zone_rouge_yellow
call prise_sol_av
propulsion.point_to palet_zone_verte_yellow,test_yaw_speeds
call stocke_palet_av_g
delay delay02
wait_movement_finished palet_zone_verte_yellow
# prise palet devant vert
call preprise_sol
propulsion.move_to palet_zone_verte_yellow,test_goldo_speeds
wait_movement_finished palet_zone_verte_yellow
call prise_sol_av
call stocke_palet_av_d
propulsion.move_to palet_zone_bleu_yellow,test_goldo_speeds
delay delay02
# prise palet devant bleu
call preprise_sol
wait_movement_finished palet_zone_bleu_yellow
call prise_sol_ar
# voyage a accelerateur
#propulsion.point_to virage_top_chaos_yellow,test_yaw_speeds
#wait_movement_finished virage_top_chaos_yellow
#propulsion.move_to virage_top_chaos_yellow,test_goldo_speeds
propulsion.point_to approche_acc_yellow,test_yaw_speeds
wait_movement_finished approche_acc_yellow
propulsion.move_to approche_acc_yellow,test_goldo_speeds
call stocke_palet_ar_g
delay delay02
call griffes_accelerateur_jaune
#wait_movement_finished virage_top_chaos_yellow
wait_movement_finished approche_acc_yellow
#propulsion.point_to virage_face_acc_advchaos_yellow,test_yaw_speeds
#wait_movement_finished virage_face_acc_advchaos_yellow
#propulsion.move_to virage_face_acc_advchaos_yellow,test_goldo_speeds
#wait_movement_finished virage_face_acc_advchaos_yellow
#propulsion.point_to approche_acc_yellow,test_yaw_speeds
#wait_movement_finished approche_acc_yellow
#propulsion.move_to approche_acc_yellow,test_goldo_speeds
propulsion.point_to contact_acc_yellow,test_yaw_speeds
wait_movement_finished contact_acc_yellow
propulsion.move_to contact_acc_yellow,approche_speeds
wait_movement_finished contact_acc_yellow
#declenchement accelerateur
#call prise_palet_accelerateur
arm.go_to_position acc_tassage,1,100
delay delay05
call slider_pousse_droite
delay delay02
call slider_range_gauche
delay delay02
#depose accelerateur
call destock_palet_ar_g
call accelerateur_jaune
delay delay02
call destock_palet_av_d
call accelerateur_jaune
delay delay02
call destock_palet_av_g
call accelerateur_jaune
delay delay02
# voyage goldenium
propulsion.move_to approche_acc_yellow,test_goldo_speeds
wait_movement_finished approche_acc_yellow
call griffes_range
propulsion.point_to approche_gold_yellow,test_yaw_speeds
wait_movement_finished approche_gold_yellow
propulsion.move_to approche_gold_yellow,test_goldo_speeds
wait_movement_finished approche_gold_yellow
call griffes_goldenium
call slider_range_droite
propulsion.point_to contact_gold_yellow,test_yaw_speeds
wait_movement_finished contact_gold_yellow
propulsion.move_to contact_gold_yellow,approche_speeds
wait_movement_finished contact_gold_yellow
#prise goldenium
call prise_goldenium
propulsion.move_to approche_gold_yellow,test_goldo_speeds
wait_movement_finished approche_gold_yellow
call griffes_range
#voyage vers balance
#propulsion.point_to virage_face_gold_advchaos_yellow,test_yaw_speeds
#wait_movement_finished virage_face_gold_advchaos_yellow
#propulsion.move_to virage_face_gold_advchaos_yellow,test_goldo_speeds
#wait_movement_finished virage_face_gold_advchaos_yellow
propulsion.point_to virage_face_balance_chaos_yellow,test_yaw_speeds
wait_movement_finished virage_face_balance_chaos_yellow
propulsion.move_to virage_face_balance_chaos_yellow,test_goldo_speeds
wait_movement_finished virage_face_balance_chaos_yellow
propulsion.point_to depose_balance_yellow,test_yaw_speeds
wait_movement_finished depose_balance_yellow
propulsion.move_to depose_balance_yellow,test_goldo_speeds
wait_movement_finished depose_balance_yellow
#depose balance
call jette_goldenium
delay delay05
call destock_palet_ar_d
delay delay05
call jette_goldenium
#collecte chaos
propulsion.move_to approche_chaos_yellow,test_goldo_speeds
wait_movement_finished approche_chaos_yellow
propulsion.point_to depose_zone_verte_rouge_yellow,test_yaw_speeds
wait_movement_finished depose_zone_verte_rouge_yellow
call griffes_chaos
propulsion.move_to depose_zone_verte_rouge_yellow,test_goldo_speeds
call preprise_sol
wait_movement_finished depose_zone_verte_rouge_yellow
call griffes_range
call prise_sol_av
propulsion.move_to approche_chaos_yellow,test_goldo_speeds
wait_movement_finished approche_chaos_yellow
propulsion.point_to depose_balance_yellow,test_yaw_speeds
wait_movement_finished depose_balance_yellow
propulsion.move_to depose_balance_yellow,test_goldo_speeds
wait_movement_finished depose_balance_yellow
call jette_goldenium
end sequence

begin sequence match_purple
propulsion.set_pose start_pose_purple
#prise palet devant rouge
call preprise_sol
propulsion.move_to palet_zone_rouge_purple,test_goldo_speeds
wait_movement_finished palet_zone_rouge_purple
call prise_sol_av
propulsion.point_to palet_zone_verte_purple,test_yaw_speeds
call stocke_palet_av_g
delay delay02
wait_movement_finished palet_zone_verte_purple
# prise palet devant vert
call preprise_sol
propulsion.move_to palet_zone_verte_purple,test_goldo_speeds
wait_movement_finished palet_zone_verte_purple
call prise_sol_av
call stocke_palet_av_d
delay delay02
# prise palet devant bleu
call preprise_sol
propulsion.move_to palet_zone_bleu_purple,test_goldo_speeds
wait_movement_finished palet_zone_bleu_purple
call prise_sol_ar
# voyage a accelerateur
#propulsion.point_to virage_top_chaos_purple,test_yaw_speeds
#wait_movement_finished virage_top_chaos_purple
#propulsion.move_to virage_top_chaos_purple,test_goldo_speeds
propulsion.point_to approche_acc_purple,test_yaw_speeds
wait_movement_finished approche_acc_purple
propulsion.move_to approche_acc_purple,test_goldo_speeds
call stocke_palet_ar_g
delay delay02
call griffes_accelerateur_violet
#wait_movement_finished virage_top_chaos_purple
wait_movement_finished approche_acc_purple
#propulsion.point_to virage_face_acc_advchaos_purple,test_yaw_speeds
#wait_movement_finished virage_face_acc_advchaos_purple
#propulsion.move_to virage_face_acc_advchaos_purple,test_goldo_speeds
#wait_movement_finished virage_face_acc_advchaos_purple
#propulsion.point_to approche_acc_purple,test_yaw_speeds
#wait_movement_finished approche_acc_purple
#propulsion.move_to approche_acc_purple,test_goldo_speeds
#wait_movement_finished approche_acc_purple
propulsion.point_to contact_acc_purple,test_yaw_speeds
wait_movement_finished contact_acc_purple
propulsion.move_to contact_acc_purple,approche_speeds
wait_movement_finished contact_acc_purple
#declenchement accelerateur
arm.go_to_position acc_tassage2,1,100
wait_arm_finished
delay delay02
call slider_pousse_gauche
delay delay05
call slider_range_droite
delay delay05
#depose accelerateur
call destock_palet_ar_g
call accelerateur_violet
delay delay02
call destock_palet_av_d
call accelerateur_violet
delay delay02
call destock_palet_av_g
call accelerateur_violet
delay delay02
# voyage goldenium
propulsion.move_to approche_acc_purple,test_goldo_speeds
wait_movement_finished approche_acc_purple
call griffes_range
propulsion.point_to approche_gold_purple,test_yaw_speeds
wait_movement_finished approche_gold_purple
propulsion.move_to approche_gold_purple,test_goldo_speeds
wait_movement_finished approche_gold_purple
call griffes_goldenium
call slider_range_gauche
propulsion.point_to contact_gold_purple,test_yaw_speeds
wait_movement_finished contact_gold_purple
propulsion.move_to contact_gold_purple,approche_speeds
wait_movement_finished contact_gold_purple
#prise goldenium
call prise_goldenium
propulsion.move_to approche_gold_purple,test_goldo_speeds
wait_movement_finished approche_gold_purple
call griffes_range
#voyage vers balance
#propulsion.point_to virage_face_gold_advchaos_purple,test_yaw_speeds
#wait_movement_finished virage_face_gold_advchaos_purple
#propulsion.move_to virage_face_gold_advchaos_purple,test_goldo_speeds
#wait_movement_finished virage_face_gold_advchaos_purple
propulsion.point_to virage_face_balance_chaos_purple,test_yaw_speeds
wait_movement_finished virage_face_balance_chaos_purple
propulsion.move_to virage_face_balance_chaos_purple,test_goldo_speeds
wait_movement_finished virage_face_balance_chaos_purple
propulsion.point_to depose_balance_purple,test_yaw_speeds
wait_movement_finished depose_balance_purple
propulsion.move_to depose_balance_purple,test_goldo_speeds
wait_movement_finished depose_balance_purple
#depose balance
call jette_goldenium
delay delay1
#collecte chaos
propulsion.move_to approche_chaos_purple,test_goldo_speeds
wait_movement_finished approche_chaos_purple
propulsion.point_to depose_zone_verte_rouge_purple,test_yaw_speeds
wait_movement_finished depose_zone_verte_rouge_purple
call griffes_chaos
propulsion.move_to depose_zone_verte_rouge_purple,test_goldo_speeds
wait_movement_finished depose_zone_verte_rouge_purple
call griffes_range
end sequence


begin sequence postmatch
propulsion.disable
propulsion.motors_disable
end sequence


begin sequence test
propulsion.motors_enable
propulsion.enable
propulsion.rotate test_angle,test_yaw_speeds
propulsion.translate test_distance,test_yaw_speeds
end sequence


begin sequence preprise_sol
arm.go_to_position sol_intermediaire,1,100
wait_arm_finished
arm.go_to_position sol_preprise_intermediaire,1,100
wait_arm_finished
arm.go_to_position sol_preprise,1,100
wait_arm_finished
end sequence

begin sequence prise_sol_av
pump.set_pwm pwm_pump_activated
arm.go_to_position sol_prise,1,75
wait_arm_finished
delay delay05
arm.go_to_position stk_av_prise,1,75
wait_arm_finished
delay delay05
end sequence

begin sequence prise_sol_av_v2
pump.set_pwm pwm_pump_activated
arm.go_to_position sol_prise,1,75
wait_arm_finished
delay delay05
arm.go_to_position sol_postprise,1,60
wait_arm_finished
delay delay02
arm.go_to_position stk_av_prise,1,100
wait_arm_finished
delay delay05
end sequence

begin sequence prise_sol_ar
pump.set_pwm pwm_pump_activated
arm.go_to_position sol_prise,1,75
wait_arm_finished
delay delay05
arm.go_to_position stk_av_prise,1,75
wait_arm_finished
delay delay02
arm.go_to_position stk_ar_prise,1,75
wait_arm_finished
delay delay05
end sequence

begin sequence test_prise_stock
call prise_sol_av
call stocke_palet_av_g
end sequence

begin sequence depose_sol
arm.go_to_position sol_intermediaire,1,100
wait_arm_finished
arm.go_to_position sol_preprise_intermediaire,1,100
wait_arm_finished
arm.go_to_position sol_preprise,1,100
wait_arm_finished
delay delay02
pump.set_pwm pwm_pump_zero
end sequence

begin sequence prise_goldenium
arm.go_to_position gold_preprise,1,100
wait_arm_finished
arm.go_to_position gold_prise,1,100
wait_arm_finished
pump.set_pwm pwm_pump_activated
delay delay1
arm.go_to_position gold_stockage_intermediaire1,1,20
wait_arm_finished
arm.go_to_position gold_stockage_intermediaire2,1,20
wait_arm_finished
arm.go_to_position gold_stockage,1,20
wait_arm_finished
end sequence

begin sequence prematch_common
pump.set_pwm pwm_pump_zero
set_servo stock_g,chargeur_gauche_sorti,100
set_servo stock_d,chargeur_droit_sorti,100
arm.go_to_position stk_av_retrait,1,100
delay delay1
propulsion.motors_enable
propulsion.enable
end sequence

begin sequence slider_pousse_gauche
set_servo slider,servo_slider_droite_presorti,100
delay delay02
set_servo slider,servo_slider_gauche,100
delay delay05
end sequence

begin sequence slider_pousse_droite
set_servo slider,servo_slider_gauche_presorti,100
delay delay02
set_servo slider,servo_slider_droite,100
delay delay05
end sequence

begin sequence slider_range_gauche
set_servo slider,servo_slider_gauche_overshoot,100
delay delay02
set_servo slider,servo_slider_gauche_range,100
delay delay05
end sequence

begin sequence slider_range_droite
set_servo slider,servo_slider_droite_overshoot,100
delay delay02
set_servo slider,servo_slider_droite_range,100
delay delay05
end sequence

begin sequence stocke_palet_av_g
arm.go_to_position stk_av_prise,1,100
wait_arm_finished
set_servo stock_g,chargeur_gauche_preprise,100
delay delay02
arm.go_to_position stk_av_tasse,1,100
wait_arm_finished
delay delay02
set_servo stock_g,chargeur_gauche_prise,100
delay delay05
pump.set_pwm pwm_pump_zero
delay delay02
arm.go_to_position stk_av_retrait,1,100
wait_arm_finished
set_servo stock_g,chargeur_gauche_sorti,100
delay delay05
end sequence

begin sequence stocke_palet_ar_g
arm.go_to_position stk_ar_prise,1,100
wait_arm_finished
set_servo stock_g,chargeur_gauche_preprise,100
delay delay02
arm.go_to_position stk_ar_tasse,1,100
wait_arm_finished
delay delay02
set_servo stock_g,chargeur_gauche_prise,100
delay delay05
pump.set_pwm pwm_pump_zero
delay delay02
arm.go_to_position stk_ar_retrait,1,100
wait_arm_finished
set_servo stock_g,chargeur_gauche_sorti,100
delay delay05
end sequence

begin sequence destock_palet_av_g
arm.go_to_position stk_av_retrait,1,100
wait_arm_finished
delay delay02
set_servo stock_g,chargeur_gauche_prise,100
delay delay1
arm.go_to_position stk_av_tasse,1,100
wait_arm_finished
pump.set_pwm pwm_pump_activated
delay delay05
arm.go_to_position stk_av_prise,1,75
wait_arm_finished
set_servo stock_g,chargeur_gauche_sorti,100
delay delay05
end sequence

begin sequence destock_palet_ar_g
arm.go_to_position stk_ar_retrait,1,100
wait_arm_finished
delay delay02
set_servo stock_g,chargeur_gauche_prise,100
delay delay1
arm.go_to_position stk_ar_tasse,1,100
wait_arm_finished
pump.set_pwm pwm_pump_activated
delay delay05
arm.go_to_position stk_ar_prise,1,75
wait_arm_finished
set_servo stock_g,chargeur_gauche_sorti,100
delay delay05
end sequence

begin sequence stocke_palet_av_d
arm.go_to_position stk_av_prise,1,100
wait_arm_finished
set_servo stock_d,chargeur_droit_preprise,100
delay delay02
arm.go_to_position stk_av_tasse,1,100
wait_arm_finished
delay delay02
set_servo stock_d,chargeur_droit_prise,100
delay delay05
pump.set_pwm pwm_pump_zero
delay delay02
arm.go_to_position stk_av_retrait,1,100
wait_arm_finished
set_servo stock_d,chargeur_droit_sorti,100
delay delay05
end sequence

begin sequence stocke_palet_ar_d
arm.go_to_position stk_ar_prise,1,100
wait_arm_finished
set_servo stock_d,chargeur_droit_preprise,100
delay delay02
arm.go_to_position stk_ar_tasse,1,100
wait_arm_finished
delay delay02
set_servo stock_d,chargeur_droit_prise,100
delay delay05
pump.set_pwm pwm_pump_zero
delay delay02
arm.go_to_position stk_ar_retrait,1,100
wait_arm_finished
set_servo stock_d,chargeur_droit_sorti,100
delay delay05
end sequence

begin sequence destock_palet_av_d
arm.go_to_position stk_av_retrait,1,100
wait_arm_finished
delay delay02
set_servo stock_d,chargeur_droit_prise,100
delay delay1
arm.go_to_position stk_av_tasse,1,100
wait_arm_finished
pump.set_pwm pwm_pump_activated
delay delay05
arm.go_to_position stk_av_prise,1,75
wait_arm_finished
set_servo stock_d,chargeur_droit_sorti,100
delay delay05
end sequence

begin sequence destock_palet_ar_d
arm.go_to_position stk_ar_retrait,1,100
wait_arm_finished
delay delay02
set_servo stock_d,chargeur_droit_prise,100
delay delay1
arm.go_to_position stk_ar_tasse,1,100
wait_arm_finished
pump.set_pwm pwm_pump_activated
delay delay05
arm.go_to_position stk_ar_prise,1,75
wait_arm_finished
set_servo stock_d,chargeur_droit_sorti,100
delay delay05
end sequence

begin sequence jette_goldenium
arm.go_to_position gold_prise,1,100
delay delay005
pump.set_pwm pwm_pump_zero
end sequence

begin sequence griffes_goldenium
set_servo griffe_g,servo_griffe_g_goldenium,100
set_servo griffe_d,servo_griffe_d_goldenium,100
end sequence

begin sequence griffes_range
set_servo griffe_g,servo_griffe_g_retrait,100
set_servo griffe_d,servo_griffe_d_retrait,100
end sequence

begin sequence griffes_accelerateur_violet
set_servo griffe_d,servo_griffe_d_accelerateur,100
set_servo griffe_g,servo_griffe_g_retrait,100
end sequence

begin sequence griffes_accelerateur_jaune
set_servo griffe_g,servo_griffe_g_accelerateur,100
set_servo griffe_d,servo_griffe_d_retrait,100
end sequence

begin sequence griffes_chaos
set_servo griffe_g,servo_griffe_g_attack,100
set_servo griffe_d,servo_griffe_d_attack,100
end sequence

begin sequence acc_depose
arm.go_to_position acc_pre_depose,1,75
wait_arm_finished
arm.go_to_position acc_depose,1,75
wait_arm_finished
delay delay02
pump.set_pwm pwm_pump_zero
delay delay02
end sequence

begin sequence tasse_accelerateur
#unused: remplacé par une position unique
arm.go_to_position acc_pre_tassage,1,75
wait_arm_finished
delay delay05
arm.go_to_position acc_tassage,1,75
wait_arm_finished
end sequence


begin sequence accelerateur_violet
#prereq: Cose sortie, palet ventouse
call griffes_accelerateur_violet
delay delay02
call acc_depose
delay delay02
arm.go_to_position acc_tassage2,1,100
wait_arm_finished
delay delay02
call slider_pousse_gauche
delay delay05
call slider_range_droite
# delay delay05
arm.go_to_position stk_av_prise,1,100
wait_arm_finished
end sequence

begin sequence accelerateur_jaune
#prereq: Cose sortie, palet ventouse
call griffes_accelerateur_jaune
delay delay02
call acc_depose
delay delay02
arm.go_to_position acc_tassage2,1,100
wait_arm_finished
delay delay02
call slider_pousse_droite
delay delay05
call slider_range_gauche
delay delay05
arm.go_to_position stk_av_prise,1,100
wait_arm_finished
end sequence

begin sequence debug
call preprise_sol
call prise_sol_av
call stocke_palet_av_g
delay delay02
# prise palet devant vert
call preprise_sol
call prise_sol_av
call stocke_palet_av_d
delay delay02
# prise palet devant bleu
call preprise_sol
call prise_sol_ar
call stocke_palet_ar_g
delay delay02
# voyage a l'accel
call griffes_accelerateur_violet
#declenchement accelerateur
arm.go_to_position acc_tassage2,1,100
wait_arm_finished
delay delay02
call slider_pousse_droite
delay delay05
call slider_range_gauche
#depose accelerateur
call destock_palet_ar_g
call accelerateur_violet
delay delay02
call destock_palet_av_d
call accelerateur_violet
delay delay02
call destock_palet_av_g
call accelerateur_violet
delay delay02
end sequence

begin sequence prise_palet_accelerateur
call slider_range_gauche
arm.go_to_position acc_depose,1,100
wait_arm_finished
delay delay05
pump.set_pwm pwm_pump_activated
delay delay05
arm.go_to_position stk_ar_retrait,1,100
wait_arm_finished
delay delay05
call stocke_palet_ar_d
delay delay02
arm.go_to_position acc_tassage,1,100
wait_arm_finished
call slider_pousse_droite
delay delay02
call slider_range_gauche
delay delay02
arm.go_to_position stk_av_retrait,1,100
end sequence